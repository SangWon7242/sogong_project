<html layout:decorate="~{layout/layout.html}">
    <body>
        <section layout:fragment="content">
            <h1>join</h1>

            <form th:action="@{/member/join}"
                  method="post"
                  id="joinForm"
                  th:object="${memberForm}"
                  class="flex flex-col gap-2">
                <div class="flex flex-col">
                    <label for="username">아이디</label>
                    <div class="flex">
                        <input type="text"
                               th:field="*{username}"
                               placeholder="아아디"
                               class="input"/>

                        <!-- 아이디 중복 확인용 -->
                        <button type="button" onclick="checkForm('true')" class="btn ml-2 mr-2">
                            중복 확인
                        </button>
                        <div th:if="${isValid != null}">
                            <div th:if="${isValid}"
                                 class="flex items-center justify-center bg-[#00aa0055] border h-10 w-16">
                                가능
                            </div>
                            <div th:unless="${isValid}"
                                 class="flex items-center justify-center bg-[#aa000055] border h-10 w-16">
                                불가능
                            </div>
                        </div>
                    </div>
                </div>
                <div th:if="${isValid == null}">
                    <div th:replace="~{error/error :: username}"></div>
                </div>

                <div class="flex flex-col">
                    <label for="password">비밀번호</label>
                    <input type="password"
                           th:field="*{password}"
                           placeholder="비밀번호"
                           class="input"/>
                </div>
                <div th:if="${isValid == null}">
                    <div th:replace="~{error/error :: password}"></div>
                </div>

                <div class="flex flex-col">
                    <label for="passwordConfirm">비밀번호 확인</label>
                    <input type="password"
                           th:field="*{passwordConfirm}"
                           placeholder="비밀번호 확인"
                           class="input"/>
                </div>
                <div th:if="${isValid == null}">
                    <div th:replace="~{error/error :: passwordConfirm}"></div>
                </div>

                <input hidden type="text" th:field="*{checkUsername}">
                <div>
                    <button type="button" onclick="checkForm('false')" class="btn">제출</button>
                </div>
            </form>

            <script>
                // 뒤로가기로 페이지 접근 방지
                window.onpageshow = function(event) {
                    if (event.persisted || (window.performance && window.performance.navigation.type === 2))
                    {
                        location.replace('/');
                    }
                };

                function checkForm(bool)
                {
                    // checkUsername 필드값 결정
                    document.getElementById('checkUsername').value = bool;
                    const form = document.getElementById('joinForm');

                    // 공백 처리
                    form.username.value = form.username.value.trim();
                    form.password.value = form.password.value.trim();
                    form.passwordConfirm.value = form.passwordConfirm.value.trim();

                    // 폼 제출
                    form.submit();
                }
            </script>
        </section>
    </body>
</html>