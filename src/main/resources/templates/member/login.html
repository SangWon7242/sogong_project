<html layout:decorate="~{layout/layout.html}">
  <body>
    <section layout:fragment="content">
      <!-- Flash Message 표시 (자동 토스트 알림) -->
      <div
        th:if="${successMessage}"
        id="successToast"
        class="fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 transform transition-all duration-500 ease-in-out opacity-0 translate-y-[-20px]"
        style="max-width: 400px"
      >
        <div class="flex items-center gap-3">
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
            ></path>
          </svg>
          <span class="font-medium" th:text="${successMessage}"></span>
        </div>
      </div>

      <script th:if="${successMessage}">
        // 토스트 알림 애니메이션
        window.addEventListener("DOMContentLoaded", function () {
          const toast = document.getElementById("successToast");

          // Fade in
          setTimeout(() => {
            toast.classList.remove("opacity-0", "translate-y-[-20px]");
            toast.classList.add("opacity-100", "translate-y-0");
          }, 100);

          // Fade out 후 제거
          setTimeout(() => {
            toast.classList.remove("opacity-100", "translate-y-0");
            toast.classList.add("opacity-0", "translate-y-[-20px]");

            // 애니메이션 완료 후 DOM에서 제거
            setTimeout(() => {
              toast.remove();
            }, 500);
          }, 3000); // 3초 후 사라짐
        });
      </script>

      <h1>login</h1>

      <form
        th:action="@{/member/login}"
        method="post"
        onsubmit="
          checkForm(this);
          return false;
        "
        class="flex flex-col gap-2"
      >
        <div class="flex flex-col">
          <label for="username">아이디</label>
          <input
            type="text"
            name="username"
            id="username"
            placeholder="아이디"
            class="input"
          />
        </div>
        <div class="flex flex-col">
          <label for="password">비밀번호</label>
          <input
            type="password"
            name="password"
            id="password"
            placeholder="비밀번호"
            class="input"
          />
        </div>
        <div>
          <button type="submit" class="btn">로그인</button>
        </div>
      </form>

      <a href="/oauth2/authorization/kakao" class="btn">카카오 로그인</a>

      <script>
        // 뒤로가기로 페이지 접근 방지
        window.onpageshow = function (event) {
          if (
            event.persisted ||
            (window.performance && window.performance.navigation.type === 2)
          ) {
            location.replace("/");
          }
        };

        function checkForm(form) {
          // 아이디 확인
          form.username.value = form.username.value.trim();
          const username = form.username;

          if (username.value === "") {
            alert("아이디를 입력해주세요.");
            username.focus();
            return;
          }

          // 비밀번호 확인
          form.password.value = form.password.value.trim();
          const password = form.password;

          if (password.value === "") {
            alert("비밀번호를 입력해주세요.");
            password.focus();
            return;
          }

          form.submit();
        }
      </script>
    </section>
  </body>
</html>
